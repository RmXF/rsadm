#!/bin/bash

# ==========================================
#  VPS WEB INSTALLER + DEPLOY PANEL
# ==========================================

clear
echo "=========================================="
echo "   INSTALADOR WEB VPS + PANEL SSH"
echo "=========================================="
sleep 2

# -------- ACTUALIZAR SISTEMA ----------
echo "Actualizando sistema..."
apt update -y && apt upgrade -y

# -------- INSTALAR PAQUETES ----------
echo "Instalando Apache, PHP y dependencias..."
apt install apache2 php php-cli php-curl unzip curl wget -y

# -------- INSTALAR SSH PASS ----------
echo "Instalando sshpass..."
apt install sshpass -y

# -------- HABILITAR APACHE ----------
systemctl enable apache2
systemctl start apache2

# -------- CONFIGURAR FIREWALL ----------
echo "Configurando firewall..."
ufw allow 22
ufw allow 80
ufw allow 443
ufw allow 8022
ufw --force enable

# -------- DESCARGAR ZIP DESDE GITHUB ----------
ZIP_URL="https://raw.githubusercontent.com/RmXF/rsadm/main/ssh-v1.zip"

echo "Descargando panel..."
cd /var/www/html
rm -rf *

wget $ZIP_URL -O panel.zip

if [ ! -f panel.zip ]; then
    echo "Error al descargar el ZIP"
    exit 1
fi

echo "Descomprimiendo..."
unzip panel.zip
rm panel.zip

chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html

# -------- MOSTRAR IP ----------
IP=$(curl -s ifconfig.me)

echo "=========================================="
echo " INSTALACION COMPLETADA"
echo "=========================================="
echo ""
echo "Accede desde tu navegador:"
echo "http://$IP"
echo ""
echo "=========================================="
